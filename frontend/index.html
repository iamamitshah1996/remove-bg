<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RemoveImageBG - Background Remover</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* checkerboard pattern for transparency preview */
    .checker {
      background-image:
        linear-gradient(45deg, #e5e5e5 25%, transparent 25%),
        linear-gradient(-45deg, #e5e5e5 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #e5e5e5 75%),
        linear-gradient(-45deg, transparent 75%, #e5e5e5 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }

    .color-swatch {
      width: 44px;
      height: 44px;
      border-radius: 9999px;
      border: 2px solid transparent;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.04);
      transition: transform 0.12s ease, box-shadow 0.12s ease;
    }

    .color-swatch:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(15,23,42,0.08);
    }

    .color-swatch.selected {
      border-color: #4f46e5;
      box-shadow: 0 0 0 2px rgba(79,70,229,0.35);
    }
  </style>
</head>

<body class="bg-slate-950 bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-50 min-h-screen">

  <!-- Top bar -->
  <header class="border-b border-slate-800/70 bg-slate-950/80 backdrop-blur">
    <div class="max-w-6xl mx-auto flex items-center justify-between py-3 px-4">
      <div class="flex items-center space-x-2">
        <div class="w-9 h-9 rounded-xl bg-indigo-500 flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-indigo-500/30">
          bg
        </div>
        <div class="flex flex-col leading-tight">
          <span class="font-semibold text-base text-slate-50">RemoveImageBG</span>
          <span class="text-[11px] text-slate-400 tracking-wide uppercase">AI background remover</span>
        </div>
      </div>

      <div class="hidden sm:flex items-center text-xs text-slate-400 space-x-3">
        <span class="inline-flex items-center space-x-1">
          <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
          <span>Backend status: <span id="status-pill" class="font-medium text-emerald-300">Ready</span></span>
        </span>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-10 space-y-10">

    <!-- Hero / uploader -->
    <section class="space-y-4 text-center">
      <h1 class="text-3xl md:text-4xl font-semibold tracking-tight text-slate-50">
        Remove Image Backgrounds Instantly
      </h1>
      <p class="text-slate-400 max-w-2xl mx-auto text-sm md:text-base">
        Upload your photo and get a crisp transparent PNG in seconds. Then add perfectly solid
        colors behind your subject ‚Äì ideal for thumbnails, product shots, and profile photos.
      </p>

      <div id="drop-area"
           class="mt-7 border border-dashed border-slate-700/80 rounded-3xl bg-slate-900/80 shadow-xl shadow-black/40 max-w-3xl mx-auto
                  p-10 flex flex-col items-center justify-center space-y-4 cursor-pointer transition-colors">

        <div class="w-12 h-12 rounded-2xl bg-indigo-500/10 border border-indigo-400/30 flex items-center justify-center text-indigo-300 text-2xl shadow-inner shadow-indigo-500/20">
          ‚¨ÜÔ∏è
        </div>
        <div class="space-y-1">
          <p class="font-medium text-slate-50 text-sm md:text-base">Drop your image anywhere inside this box</p>
          <p class="text-xs md:text-sm text-slate-400">or click the button below to browse from your device</p>
        </div>

        <input type="file" id="file-input" accept="image/*" class="hidden" />
        <button id="choose-btn"
                class="mt-3 inline-flex items-center px-6 py-2.5 rounded-full
                       bg-indigo-500 hover:bg-indigo-400 text-white text-sm font-medium
                       shadow-md shadow-indigo-500/40 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 focus:ring-offset-slate-900">
          <span class="mr-2 text-[13px]">üìÅ</span>
          <span>Choose Image</span>
        </button>

        <p class="text-[11px] text-slate-500 mt-2">
          Supports <span class="font-medium text-slate-300">JPG, PNG, WEBP</span> ‚Äî Max 10MB
        </p>

        <!-- status text -->
        <p id="status-text" class="text-[11px] mt-2 hidden"></p>

        <!-- progress bar -->
        <div id="progress-wrapper"
             class="hidden w-full max-w-xs mx-auto mt-3 text-left">
          <div class="w-full bg-slate-800 rounded-full h-2 overflow-hidden">
            <div id="progress-bar" class="h-2 bg-gradient-to-r from-indigo-400 via-sky-400 to-emerald-400 w-0 transition-all"></div>
          </div>
          <p id="progress-label" class="text-[11px] text-slate-400 mt-1">Uploading‚Ä¶</p>
        </div>

        <div class="flex flex-wrap justify-center gap-x-4 gap-y-1 pt-3 text-[11px] text-slate-500">
          <span>Step 1: Upload ‚Üí</span>
          <span>Step 2: Wait for magic ‚Üí</span>
          <span>Step 3: Pick a background ‚Üí</span>
          <span>Step 4: Download</span>
        </div>
      </div>
    </section>

    <!-- Preview + tools -->
    <section id="result-section" class="grid md:grid-cols-[2fr,1.1fr] gap-6 md:gap-8 items-start hidden">

      <!-- Left: original + processed -->
      <div class="space-y-4">
        <div class="grid md:grid-cols-2 gap-4">
          <!-- Original -->
          <div class="bg-slate-900/90 rounded-2xl shadow-lg shadow-black/40 overflow-hidden border border-slate-800">
            <div class="border-b border-slate-800 px-4 py-2.5 text-xs font-medium text-slate-200 flex items-center justify-between">
              <span>Original</span>
              <span class="text-[11px] text-slate-500">Preview only ¬∑ unchanged</span>
            </div>
            <div class="checker flex items-center justify-center min-h-[260px] p-3">
              <img id="original-img" class="max-w-full max-h-[360px] object-contain rounded-lg shadow-sm shadow-slate-900/70" />
            </div>
          </div>

          <!-- Cutout + BG -->
          <div class="bg-slate-900/90 rounded-2xl shadow-lg shadow-black/40 overflow-hidden border border-slate-800">
            <div class="border-b border-slate-800 px-4 py-2.5 text-xs font-medium text-slate-200 flex items-center justify-between">
              <span>Background Removed</span>
              <span id="bg-label" class="text-[11px] text-slate-500">(transparent)</span>
            </div>
            <div id="preview-wrapper"
                 class="checker flex items-center justify-center min-h-[260px] p-3 rounded-b-2xl">
              <canvas id="preview-canvas"
                      class="max-w-full max-h-[360px] rounded-lg shadow-sm shadow-slate-900/70"></canvas>
            </div>
          </div>
        </div>

        <!-- Download buttons -->
        <div class="flex flex-wrap items-center gap-3 bg-slate-900/80 border border-slate-800 rounded-2xl px-4 py-3">
          <button id="download-transparent"
                  class="inline-flex items-center px-4 py-2 text-xs md:text-sm rounded-full bg-slate-100 text-slate-900 font-medium shadow-sm shadow-slate-900/70 disabled:opacity-40 disabled:cursor-not-allowed">
            <span class="mr-2">üßä</span>
            <span>Download Transparent PNG</span>
          </button>
          <button id="download-colored"
                  class="inline-flex items-center px-4 py-2 text-xs md:text-sm rounded-full bg-indigo-500 text-white font-medium shadow-sm shadow-indigo-500/40 disabled:opacity-40 disabled:cursor-not-allowed">
            <span class="mr-2">üé®</span>
            <span>Download With Background</span>
          </button>
          <span class="text-[11px] md:text-xs text-slate-400">
            Tip: pick a color on the right, then click ‚ÄúDownload With Background‚Äù.
          </span>
        </div>
      </div>

      <!-- Right: background color picker -->
      <aside class="bg-slate-900/90 rounded-2xl shadow-lg shadow-black/40 p-4 md:p-5 space-y-4 border border-slate-800">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="font-semibold text-slate-100 text-sm">Background</h2>
            <p class="text-[11px] text-slate-500">Set the canvas color behind your subject.</p>
          </div>
          <span id="current-color-label" class="text-[11px] bg-slate-800/80 text-slate-200 px-2 py-1 rounded-full border border-slate-700">
            Transparent
          </span>
        </div>

        <!-- Mode pills -->
        <div class="inline-flex rounded-full bg-slate-800/80 p-1 text-[11px] font-medium mt-1">
          <button id="mode-transparent"
                  class="px-3 py-1 rounded-full bg-slate-950 text-slate-50 shadow-sm shadow-black/50 border border-slate-700">
            Transparent
          </button>
          <button disabled
                  class="px-3 py-1 rounded-full text-slate-500 cursor-not-allowed">
            Photo (coming soon)
          </button>
          <button id="mode-color"
                  class="px-3 py-1 rounded-full text-slate-200 hover:text-white">
            Color
          </button>
        </div>

        <!-- Swatches -->
        <div class="mt-3">
          <p class="text-[11px] text-slate-400 mb-2">Quick colors</p>
          <div class="grid grid-cols-4 gap-3">
            <button class="color-swatch bg-white border border-slate-300"
                    data-color="transparent" title="Transparent">
            </button>
            <button class="color-swatch" style="background:#ffffff"
                    data-color="#ffffff" title="White">
            </button>
            <button class="color-swatch" style="background:#f97316"
                    data-color="#f97316" title="Orange">
            </button>
            <button class="color-swatch" style="background:#ef4444"
                    data-color="#ef4444" title="Red">
            </button>
            <button class="color-swatch" style="background:#ec4899"
                    data-color="#ec4899" title="Pink">
            </button>
            <button class="color-swatch" style="background:#a855f7"
                    data-color="#a855f7" title="Purple">
            </button>
            <button class="color-swatch" style="background:#3b82f6"
                    data-color="#3b82f6" title="Blue">
            </button>
            <button class="color-swatch" style="background:#22c55e"
                    data-color="#22c55e" title="Green">
            </button>
          </div>
        </div>

        <!-- Custom color -->
        <div class="mt-4 flex items-center justify-between">
          <label class="text-xs font-medium text-slate-200 flex items-center space-x-2">
            <span>Custom color</span>
            <input id="custom-color" type="color" value="#000000"
                   class="w-7 h-7 rounded-full border border-slate-600 p-0 cursor-pointer bg-slate-900" />
          </label>
          <p class="text-[11px] text-slate-500">
            Paste hex in your OS picker to match your brand.
          </p>
        </div>
      </aside>
    </section>
  </main>

  <script>
    // ==================== CONFIG ====================
    const BACKEND_URL =
      window.location.hostname === "localhost"
        ? "http://localhost:5000/remove-bg"
        : "http://" + window.location.hostname + ":5000/remove-bg";

    // ==================== DOM REFS ====================
    const fileInput          = document.getElementById("file-input");
    const chooseBtn          = document.getElementById("choose-btn");
    const dropArea           = document.getElementById("drop-area");
    const statusText         = document.getElementById("status-text");
    const progressWrapper    = document.getElementById("progress-wrapper");
    const progressBar        = document.getElementById("progress-bar");
    const progressLabel      = document.getElementById("progress-label");

    const resultSection      = document.getElementById("result-section");
    const originalImg        = document.getElementById("original-img");
    const canvas             = document.getElementById("preview-canvas");
    const ctx                = canvas.getContext("2d");
    const previewWrapper     = document.getElementById("preview-wrapper");
    const bgLabel            = document.getElementById("bg-label");

    const dlTransparentBtn   = document.getElementById("download-transparent");
    const dlColoredBtn       = document.getElementById("download-colored");

    const modeTransparentBtn = document.getElementById("mode-transparent");
    const modeColorBtn       = document.getElementById("mode-color");
    const currentColorLabel  = document.getElementById("current-color-label");
    const colorSwatches      = Array.from(document.querySelectorAll(".color-swatch"));
    const customColorInput   = document.getElementById("custom-color");

    // ==================== STATE ====================
    let processedBlobUrl = null;
    let coloredDownloadUrl = null;
    let imgObj = new Image();
    let selectedColor = "transparent";

    // ==================== HELPERS ====================
    function setStatus(msg, isError = false) {
      if (!msg) {
        statusText.classList.add("hidden");
        statusText.textContent = "";
      } else {
        statusText.classList.remove("hidden");
        statusText.textContent = msg;
        statusText.className =
          "text-[11px] mt-2 " + (isError ? "text-rose-400" : "text-emerald-300");
      }
    }

    function showProgress() {
      progressWrapper.classList.remove("hidden");
      setProgress(0, "Uploading‚Ä¶");
    }

    function hideProgress() {
      progressWrapper.classList.add("hidden");
      progressBar.style.width = "0%";
      progressLabel.textContent = "";
    }

    function setProgress(percent, label) {
      progressBar.style.width = Math.min(Math.max(percent, 0), 100) + "%";
      if (label) progressLabel.textContent = label;
    }

    function setButtonsEnabled(enabled) {
      dlTransparentBtn.disabled = !enabled;
      dlColoredBtn.disabled = !enabled;
    }

    function updateBgLabels() {
      if (selectedColor === "transparent") {
        bgLabel.textContent = "(transparent)";
        currentColorLabel.textContent = "Transparent";
      } else {
        bgLabel.textContent = "";
        currentColorLabel.textContent = selectedColor.toUpperCase();
      }
    }

    // ==================== CANVAS DRAWING ====================
    function drawPreview() {
      if (!imgObj.src) return;

      const maxWidth  = 600;
      const maxHeight = 400;
      const scale = Math.min(
        maxWidth / imgObj.naturalWidth,
        maxHeight / imgObj.naturalHeight,
        1
      );

      const w = imgObj.naturalWidth * scale;
      const h = imgObj.naturalHeight * scale;

      canvas.width = w;
      canvas.height = h;

      if (selectedColor === "transparent") {
        previewWrapper.classList.add("checker");
        previewWrapper.style.backgroundColor = "transparent";
        ctx.clearRect(0, 0, w, h);
      } else {
        previewWrapper.classList.remove("checker");
        previewWrapper.style.backgroundColor = selectedColor;
        ctx.fillStyle = selectedColor;
        ctx.fillRect(0, 0, w, h);
      }

      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = "high";
      ctx.drawImage(imgObj, 0, 0, w, h);

      if (coloredDownloadUrl) {
        URL.revokeObjectURL(coloredDownloadUrl);
        coloredDownloadUrl = null;
      }
      canvas.toBlob((blob) => {
        if (blob) {
          coloredDownloadUrl = URL.createObjectURL(blob);
        }
      }, "image/png");
    }

    // ==================== UPLOAD WITH PROGRESS ====================
    function sendWithProgress(formData) {
      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open("POST", BACKEND_URL, true);
        xhr.responseType = "blob";

        xhr.upload.onprogress = (e) => {
          if (e.lengthComputable) {
            const pct = Math.round((e.loaded / e.total) * 70);
            setProgress(pct, "Uploading‚Ä¶");
          }
        };

        xhr.onreadystatechange = () => {
          if (xhr.readyState === 4) {
            if (xhr.status >= 200 && xhr.status < 300) {
              setProgress(100, "Done");
              resolve(xhr.response);
            } else {
              reject(new Error("Backend error: " + xhr.statusText));
            }
          }
        };

        xhr.onerror = () => reject(new Error("Network error"));

        setProgress(5, "Uploading‚Ä¶");
        xhr.send(formData);

        xhr.upload.onload = () => {
          setProgress(80, "Processing on server‚Ä¶");
        };
      });
    }

    // ==================== MAIN FILE HANDLER ====================
    async function handleFile(file) {
      if (!file) return;
      if (file.size > 10 * 1024 * 1024) {
        setStatus("File is larger than 10MB.", true);
        return;
      }

      setButtonsEnabled(false);
      showProgress();
      setStatus("");

      originalImg.src = URL.createObjectURL(file);
      resultSection.classList.remove("hidden");

      const formData = new FormData();
      formData.append("image", file);

      try {
        const blob = await sendWithProgress(formData);

        if (processedBlobUrl) URL.revokeObjectURL(processedBlobUrl);
        processedBlobUrl = URL.createObjectURL(blob);

        imgObj.onload = () => {
          drawPreview();
          setButtonsEnabled(true);
          hideProgress();
          setStatus("Background removed successfully.");
        };
        imgObj.src = processedBlobUrl;

      } catch (err) {
        console.error(err);
        hideProgress();
        setStatus(err.message || "Failed to connect to backend", true);
      }
    }

    // ==================== EVENT WIRING ====================

    // Button click: open file dialog once (fix Chrome double dialog)
    chooseBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      fileInput.click();
    });

    // Clicking anywhere else in drop area
    dropArea.addEventListener("click", (e) => {
      if (e.target === chooseBtn) return;
      fileInput.click();
    });

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      handleFile(file);
    });

    // drag & drop styling
    ["dragenter", "dragover"].forEach(ev => {
      dropArea.addEventListener(ev, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropArea.classList.add("border-indigo-400", "bg-slate-900", "shadow-indigo-500/40");
      });
    });

    ["dragleave", "drop"].forEach(ev => {
      dropArea.addEventListener(ev, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropArea.classList.remove("border-indigo-400", "bg-slate-900", "shadow-indigo-500/40");
      });
    });

    dropArea.addEventListener("drop", (e) => {
      const file = e.dataTransfer.files[0];
      handleFile(file);
    });

    // downloads
    dlTransparentBtn.addEventListener("click", () => {
      if (!processedBlobUrl) return;
      const a = document.createElement("a");
      a.href = processedBlobUrl;
      a.download = "removed-transparent.png";
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    dlColoredBtn.addEventListener("click", () => {
      if (!coloredDownloadUrl) return;
      const a = document.createElement("a");
      a.href = coloredDownloadUrl;
      a.download = "removed-colored.png";
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    // color selection
    function selectColor(color) {
      selectedColor = color;
      colorSwatches.forEach(sw => {
        if (sw.dataset.color === color) sw.classList.add("selected");
        else sw.classList.remove("selected");
      });
      updateBgLabels();
      drawPreview();
    }

    colorSwatches.forEach(sw => {
      sw.addEventListener("click", () => {
        const c = sw.dataset.color;
        selectColor(c);
      });
    });

    customColorInput.addEventListener("input", (e) => {
      const c = e.target.value;
      selectColor(c);
    });

    modeTransparentBtn.addEventListener("click", () => {
      selectColor("transparent");
    });

    modeColorBtn.addEventListener("click", () => {
      if (selectedColor === "transparent") {
        selectColor("#ffffff");
      }
    });

    // initial
    selectColor("transparent");
  </script>
</body>
</html>

